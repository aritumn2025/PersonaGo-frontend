# DiagnoseConfig 設定方法

このドキュメントは、`DiagnoseConfig` を使って診断ロジックを定義するための仕様の概要です。

## 診断方法の概要

1. 診断の際には、複数の「軸 (labels)」を定義します。
   - 例: MBTIなら EI(外向↔内向), SN(感覚↔直感), TF(思考↔感情), JP(判断↔知覚) など
   - 各軸には「正/負」の2方向を定義します。例えば EI なら「外向性 (E)」が正、「内向性 (I)」が負のようにします。(どちらが正/負かは任意)

2. 各質問 (questions) は、回答に応じて1つ以上の軸に対してスコアを加点します。
   - 例: 「大人数でのパーティーに参加するのが好きだ」→ EI に +1 (外向性寄りに加点)
   - 例: 「一人でいる時間が好きだ」→ EI に -1 (内向性寄りに加点)

3. 最終的に、各軸のスコアが「0以上か、負か」で2分判定し、その組み合わせで診断結果を決定します。
   - 例: 軸EIのスコアが+4だった -> 外向性寄り (E)
   - 例: 軸SNのスコアが-2だった -> 直感寄り (N)

より具体的には以下のように動作します:

1. すべてのラベルについて、設定したバイアスを初期値としてスコアベクトルを作成する

2. 各質問に回答するたびに、その質問に対応するスコアをスコアベクトルに加算

3. 最終的なスコアベクトルに対して、各ラベルごとに「非負か、負か」で2分判定
   - 非負 → `1`
   - 負 → `0`

4. 判定結果をビット列化して `result` 配列のインデックスを決定し、その値を診断結果として返す

## 設定の基本構造

### TypeScript 型定義

```ts
type PersonalityId = string; // 診断結果の識別子

// 設定オブジェクト
type DiagnoseConfig<K extends string> = Readonly<{
  // 診断の軸
  labels: {
    id: K; // 軸の識別子(ロジック用、表示には使わない)
    text: string; // 軸の名前(表示用)
    description: string; // 軸の説明(表示用)

    // 軸の正/負の方向の説明
    positive: {
      text: string; // 正の方向の名前
      description: string; // 正の方向の説明
    };
    negative: {
      text: string; // 負の方向の名前
      description: string; // 負の方向の説明
    };

    bias: number; // 初期スコア(0が基本。正値ならpositive寄りスタート)
  }[];

  // 質問の定義
  // 質問には連続的・離散的の2種類がある
  questions:
    | {
        // 連続的質問(あてはまる〜あてはまらないのn段階評価)
        kind: "continuous";
        text: string; // 質問文
        options: { left: string; right: string; count: number }; // 選択肢の定義
      }
    | {
        // 離散的質問(選択肢から1つ選ぶ)
        kind: "discrete";
        text: string; // 質問文
        options: { index: number; text: string }[]; // 選択肢の定義
      }[];

  // 診断結果の定義
  // 結果は2^(ラベル数)通り必要
  result: PersonalityId[];
}>;
```

### 例

[config.example.ts](config.example.ts)を参照。

## 各設定の詳細

- **labels**: 軸（MBTIなら EI, SN, TF, JP など。説明なども含む）を定義します。
- **questions**: 質問を定義します。質問方法には連続型/離散型の2種類があります。
- **result**: 全ての組み合わせに対応する診断結果。

## labels

各軸は「正/負の二方向」として定義します。

```ts
{
  id: "EI", // 軸の識別子
  text: "外向性 vs 内向性", // 軸の名前
  description: "人と関わることを好むか、一人でいることを好むか", // 軸の説明
  positive: { text: "外向性 (E)", description: "..." }, // 正の方向の説明
  negative: { text: "内向性 (I)", description: "..." }, // 負の方向の説明
  bias: 0, // 初期スコア（0が基本。正値ならpositive寄りスタート）
}
```

- `id` は一意である必要があります。
- `bias` は未回答時の初期スコア。0が基本で、±1程度で軽く傾向をつけるのに使います。

## questions

質問には **2種類** あります。

### Continuous (連続)

スライダーやリッカート尺度 (1〜5など) に対応。
回答値は `0〜count-1` で渡され、線形補間によってスコアが計算されます。

```ts
{
  kind: "continuous",// 連続型の質問にしたいときに指定
  text: "大人数でのパーティーに参加するのが好きだ", // 質問文
  options: {
    count: 5, // 段階数
    left: {
      text: "あてはまる", // 左端の選択肢
      score: { EI: 1, SN: 1 }, // 左端の選択肢に対応するスコア加点
    },
    right: {
      text: "あてはまらない", // 右端の選択肢
      score: { EI: -1, SN: -1 }, // 右端の選択肢に対応するスコア加点
    },
  },
}
```

### Discrete (離散)

複数選択肢から選ぶ形式。

```ts
{
  kind: "discrete", // 離散型の質問にしたいときに指定
  text: "どちらの説明がより自分に当てはまりますか？", // 質問文
  // 質問の選択肢とその選択肢に対応するスコア
  options: [
    { text: "現実的で...", score: { SN: 1 } },0, TF: 0, JP: 0
    { text: "未来の可能性...", score: { SN: -1 } },
  ],
}
```

#### 複数ラベルに影響させることも可能

```ts
{
  kind: "discrete",
  text: "論理的に説明しつつ、計画的に進めることが得意だ",
  options: [
    { text: "はい", score: { TF: 1, JP: 1 } },
    { text: "いいえ", score: { TF: -1, JP: -1 } },
  ],
}
```

## result

- 結果は **2^(ラベル数)** 通り必要です。
- 配列順は `labels` の並び順に依存し、各ラベルのスコアが非負(>=0)なら `1`、負なら `0` としてビット列を作り、その値で `result` 配列のインデックスを決定します。

例:
labels = `[EI, SN]` の場合

- EI<0, SN<0 → `00` → `result[0]`
- EI<0, SN>=0 → `01` → `result[1]`
- EI>=0, SN<0 → `10` → `result[2]`
- EI>=0, SN>=0 → `11` → `result[3]`

## 設計の流れ

1. 診断の軸 (labels) を決める

2. 軸に基づいて診断結果 (result) の候補を決める

3. 軸に基づいて質問 (questions) を設計する

4. 設定ファイルは[/constants/diagnose.ts](/constants/diagnose.ts)に配置してあるので、そこを書き換えてください。

### 一貫性を保つために

- 連続質問では左に肯定的、右に否定的な意味合いの文言を設定してください
- 離散質問では選択肢の順番に意味はありませんが、肯定的な選択肢を上に置くことが多いです。
- 連続質問ではleft/rightのラベル名(text)を自由に設定できますが、基本的には「あてはまる」「あてはらない」などで統一するようにしてください。
- 連続質問の段階数(count)は7を推奨します(画面のサイズや見た目的にちょうどいいため)。また、他の値にするにしても、全ての質問で同じ値に統一してください。
